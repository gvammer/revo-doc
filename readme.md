# Рево Рассрочка: Плагин для 1С Битрикс 

Модуль позволяет подключить платежную систему Оплата Частями Рево к интернет-магазину битрикс. 

```
!!! Важно: модуль требует расширения php-curl на сайте
```

## Платежная система

Модуль при установке добавляет платежную систему "Оплата Частями" в интернет-магазин битрикс.
При выборе платежной системы в стандартном компоненте оформления заказа модуль 
открывает окно регистрации в РЕВО.

При оформлении заказа и переходе к оплате модуль открывает окно оформления заказа в РЕВО.

Оплатить в рассрочку на 12 месяцев возможно не более 100% и не менее 20% от заказа (параметр задан в настройках модуля).

Минимальная сумма заказа должна быть при этом не менее 3 000 руб. 

При этом дополнительно в настройках модуля нужно указать максимальную сумму товара для отображения ссылки на детальной странице.

Оплата производится посредством вызова модального окна оформления рассрочки.

Система проверяет, был ли у пользователя оформлен кредитный лимит. 
Если нет, перед оформлением заказа
пользователю показывается окно получения лимита.

## Основные настройки модуля

Основные настройки модуля доступны в разделе Настройки -> Модули -> Оплата заказа частями

![Настройки модуля](https://i.snipboard.io/HDg8CM.jpg)

Максимальная доля оплаты частями. Если ваш тариф требует предоплаты заказа на сайте, укажите тут ту сумму, которая будет оплачиваться рассрочкой. Чаще всего это не требуется.

Минимальная цена товара для отображения виджета. Минимальная цена, при которой выводится виджет в карточке товара с ценой при оплате частями.

Максимальная цена товара для отображения виджета. Максимальная цена, при которой выводится виджет в карточке товара с ценой при оплате частями.

Страница перенаправления пользователя после оформления заказа. Страница, куда отправится пользователь после оформления оплаты частями.

Код статуса, при котором отправлять отмену заказа. Оплаты частями на стороне РЕВО могут отменяться автоматически, вам просто нужно указать статус заказа, при котором нужно послать оповещение в РЕВО.

Код статуса, при котором отправлять финализацию заказа. Оплата в рассрочку двустадийная - фактически перевод средств осуществляется после того, как заказ финально подтвержден на стороне магазина (например, отгружен товар). Обязательно укажите статус заказа, при котором у клиента стартует оплата частями.

Email администратора. Адрес, на который приходят ошибки финализации заказа. В случае если вы получили такое письмо, вам следует немедленно обратиться к менеджеру в компании РЕВО.

## Компонент Товар Детально

В стандартном компоненте детальной страницы товара модуль позволяет добавить ссылку "Оформить рассрочку".
При нажатии на ссылку открывается окно получения лимита в РЕВО.

## Компонент Корзина товаров

В стандартный компонент "Корзина товаров" модуля "Интернет-магазин" автоматически добавляется 
ссылка оформления заказа в рассрочку.

![Сниппет в корзине](https://i.snag.gy/X6Rc3g.jpg)

## Финализация заказа

Для подтверждения заказа после одобрения и оплаты через РЕВО необходимо
перевести заказ в статус "Выполнен". При этом в РЕВО автоматически будет доставлен чек заказа для подтверждения выдачи рассрочки.

## Сниппет и компонент

Модуль предоставляет для работы с заказом сниппет и компонент "Оформить заказ в рассрочку". 
Сниппет и компонент реализуют ссылку для оформления товара в рассрочку. ID товара и ежемесячный платеж указываются 
в настройках компонента или в соответствующем тексте сниппета. Для автоматического добавления товара и перехода в корзину 
необходимо указать ID товара, его можно взять из родительского компонента или из глобального массива **\$_REQUEST**.

_! После установки модуля необходимо обновить кэш списка компонентов и сниппетов в визуальном редакторе_

![Компонент](https://i.snag.gy/xIP2tJ.jpg)

![Сниппет](https://i.snag.gy/jU8qkD.jpg)

## Установка компонента в шаблон другого компонента

Поскольку компонент ссылки оформления рассрочки зависит от конкретного товара, лучше всего
его внедрять в шаблон компонента "catalog.element" или его аналога на вашем сайте.

Для внедрения компонента необходимо добавить в место выведения ссылки следующий код:

```php

<?$APPLICATION->IncludeComponent(
	"revo:buy.link",
	"",
	Array(
		"PRICE" => $arResult['ITEM_PRICES'][0]['BASE_PRICE'],
		"BUY_BTN_SELECTOR" => '#' . $itemIds['BUY_LINK']
	)
);?>


```

Компонент принимает два параметра 

- исходную цену, от которой будет расчитана ежемесячная оплата
- селектор кнопки оформления заказа. Скрипт автоматически произведет клик на нее после получения лимита.

## Настройка печатной формы

Для отправки в Рево данных необходимо обязательно настроить печатную форму. 
Это можно сделать на странице настройки платежной системы "Оплата Частями" в разделе

`Магазин > Настройки > Платежные системы`.

## Данные для тестирования

Данные для тестирования необходимо запросить у вашего менеджера.
